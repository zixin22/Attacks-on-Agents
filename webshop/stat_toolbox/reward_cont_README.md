# reward_cont.py User Guide

## ğŸ“‹ Overview

`reward_cont.py` is a tool for analyzing `memory_X.json` files generated by RAP training. It extracts all fixed numbers that have a "Reward" key, and specifically those with "Reward" >= 0.5.

## ğŸ¯ Features

1. **Extract all fixed numbers with "Reward" key**
   - Identifies all entries containing a "Reward" field from memory JSON files
   - Extracts corresponding fixed numbers (e.g., `fixed_0`, `fixed_22`, etc.)

2. **Extract all fixed numbers with "Reward" >= 0.5**
   - Filters entries with Reward values greater than or equal to 0.5
   - These typically represent samples with higher task completion rates

3. **Generate analysis report**
   - Outputs analysis results to console
   - Saves detailed analysis report to a text file

## ğŸ“¦ Dependencies

- Python 3.6+
- Standard libraries: `json`, `sys`, `os`, `re`

## ğŸš€ Usage

### Basic Usage

```bash
python reward_cont.py <memory_file_path>
```

### Parameters

- `<memory_file_path>`: Path to the memory JSON file (required)
  - Example: `../output_0_500/memory_1.json`
  - Or: `C:\Users\22749\Desktop\rap-main\webshop\output_0_500\memory_1.json`

### Examples

#### Example 1: Analyze a single memory file

```bash
# Relative path
python reward_cont.py ../output_0_500/memory_1.json

# Absolute path (Windows)
python reward_cont.py C:\Users\22749\Desktop\rap-main\webshop\output_0_500\memory_1.json
```

#### Example 2: Analyze memory files from different trials

```bash
# Trial 1
python reward_cont.py ../output_0_500/memory_1.json

# Trial 2
python reward_cont.py ../output_0_500/memory_2.json
```

## ğŸ“Š Output

### Console Output

The program displays:

```
============================================================
åˆ†ææ–‡ä»¶: ../output_0_500/memory_1.json
============================================================

1. æ‰€æœ‰å…·æœ‰ 'Reward' é”®çš„ fixed åºå· (å…± 79 ä¸ª):
   [0, 7, 29, 35, 37, 38, 39, ...]

2. æ‰€æœ‰ 'Reward' >= 0.5 çš„ fixed åºå· (å…± 45 ä¸ª):
   [0, 7, 29, 35, 37, 38, ...]

ç»Ÿè®¡ä¿¡æ¯:
  - æ€»æ¡ç›®æ•°: 79
  - Reward >= 0.5 çš„æ¡ç›®æ•°: 45
  - Reward >= 0.5 çš„æ¯”ä¾‹: 56.96%

ç»“æœå·²ä¿å­˜åˆ°: ../output_0_500/memory_1_reward_analysis.txt
```

### Output File

The program generates an analysis report file in the same directory as the memory JSON file:

- **File name format**: `<original_filename>_reward_analysis.txt`
- **Example**: `memory_1.json` â†’ `memory_1_reward_analysis.txt`

**File contents include**:
- Path of the analyzed file
- List of all fixed numbers with 'Reward' key
- List of all fixed numbers with 'Reward' >= 0.5
- Statistics (total count, percentage, etc.)

## ğŸ“ Output File Format Example

```
åˆ†ææ–‡ä»¶: ../output_0_500/memory_1.json
============================================================

1. æ‰€æœ‰å…·æœ‰ 'Reward' é”®çš„ fixed åºå· (å…± 79 ä¸ª):
[0, 7, 29, 35, 37, 38, 39, 43, 46, 48, 49, 53, 68, 77, ...]

2. æ‰€æœ‰ 'Reward' >= 0.5 çš„ fixed åºå· (å…± 45 ä¸ª):
[0, 7, 29, 35, 37, 38, 39, 43, 46, 48, 49, 53, 68, 77, ...]

ç»Ÿè®¡ä¿¡æ¯:
  - æ€»æ¡ç›®æ•°: 79
  - Reward >= 0.5 çš„æ¡ç›®æ•°: 45
  - Reward >= 0.5 çš„æ¯”ä¾‹: 56.96%
```

## ğŸ” How It Works

1. **Read JSON file**: Loads the memory JSON file
2. **Parse entries**: Iterates through all entries, extracts `Id` field (format: `fixed_X`)
3. **Extract numbers**: Uses regular expressions to extract numeric indices from `Id`
4. **Filter Reward**: 
   - Checks if entry contains "Reward" key
   - If Reward >= 0.5, adds to high-reward list
5. **Sort and output**: Sorts the number lists and outputs results

## âš ï¸ Notes

1. **File format**: Input JSON file must be in valid memory format
   - Should be a list, each element is a dictionary
   - Each dictionary should contain an `Id` field (format: `fixed_X`)

2. **Reward value type**: 
   - Reward values can be integers or floats
   - Only numeric types with value >= 0.5 will be filtered

3. **File paths**: 
   - Supports both relative and absolute paths
   - Windows paths can use either backslash `\` or forward slash `/`

4. **Output file location**: 
   - Output file is saved in the same directory as the input file
   - Program will error if directory doesn't exist or lacks write permissions

## ğŸ› Common Errors

### Error 1: File not found

```
é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨: ../output_0_500/memory_1.json
```

**Solution**: Check if the file path is correct

### Error 2: JSON parsing failed

```
é”™è¯¯: JSON è§£æå¤±è´¥: Expecting value: line 1 column 1 (char 0)
```

**Solution**: Check if the JSON file format is correct

### Error 3: Cannot parse Id

```
è­¦å‘Š: æ— æ³•è§£æ Id: abc123
```

**Note**: This is not a fatal error; the program will skip unparseable entries and continue

## ğŸ“š Related Tools

- **merge.py**: Merge results from multiple `_reward_analysis.txt` files
- See `merge_README.md` for detailed usage

## ğŸ’¡ Use Cases

1. **Filter high-quality samples**: Find samples with Reward >= 0.5 for further analysis
2. **Dataset construction**: Extract specific fixed numbers for building new training datasets
3. **Performance evaluation**: Statistics on success rates and reward distributions across different trials
4. **Data cleaning**: Identify which tasks have been completed (have Reward values)

## ğŸ”— Next Steps

After analysis, you can:

1. **Merge multiple analysis results**: Use `merge.py` to merge multiple `_reward_analysis.txt` files
2. **Build new dataset**: Use extracted fixed numbers to build filtered datasets
3. **Further analysis**: Perform deeper data analysis based on Reward values
